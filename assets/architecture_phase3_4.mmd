graph LR
    %% User Input
    User((User Input))

    %% Core Components
    subgraph Orcehstrator [app/supervisor/]
        Router{app/supervisor/<br/>intent.py}
        Groq8B((Groq:<br/>llama-3.1-8b))
    end

    subgraph Phase4 [app/agents/]
        direction TB
        Space1[ ]
        Space1 ~~~ Smalltalk[app/supervisor/<br/>router.py]
        Space1 ~~~ Analytical[app/agents/<br/>analytical.py]
        RagAgent[app/agents/<br/>rag.py]
        style Space1 height:0px,width:0px,fill:none,stroke:none,color:none
    end
    
    subgraph Phase3 [app/retrieval/]
        direction TB
        Space2[ ]
        VectorDB[(Qdrant<br/>Cloud DB)]
        style Space2 height:0px,width:0px,fill:none,stroke:none,color:none
    end

    %% Flow
    User -->|Query| Router
    Router -.->|0.0s Triage| Groq8B
    
    Router -->|Intent: Greeting| Smalltalk
    Router -->|Intent: Reasoning| Analytical
    Router -->|Intent: Question| RagAgent
    
    Analytical -->|Hybrid Search| VectorDB
    RagAgent -->|Search| VectorDB
    
    VectorDB -.->|Context| Analytical
    VectorDB -.->|Context| RagAgent

    %% Styling to perfectly match Phase 1 & 2
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
    classDef input fill:#e1f5fe,stroke:#0288d1,stroke-width:2px;
    classDef core fill:#e8f5e9,stroke:#388e3c,stroke-width:2px;
    classDef storage fill:#fff3e0,stroke:#f57c00,stroke-width:2px;
    classDef agent fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;

    class User input;
    class Router,Smalltalk,Analytical,RagAgent agent;
    class Groq8B core;
    class VectorDB storage;
